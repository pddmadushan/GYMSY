<UserControl xmlns:CMSXtream="clr-namespace:CMSXtream"  x:Class="CMSXtream.Pages.DataEntry.ClassAttendance"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:mui="http://firstfloorsoftware.com/ModernUI" 
             mc:Ignorable="d" Loaded="UserControl_Loaded" 
             xmlns:local="clr-namespace:CMSXtream.Handlers" 
             xmlns:mycls="clr-namespace:CMSXtream.Pages.DataEntry" Unloaded="UserControl_Unloaded" 
             >
    <UserControl.Resources >
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="pack://application:,,,/StyleResource/ComboBoxStyle.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/StyleResource/AttendanceDataGid.xaml"/>
                <ResourceDictionary Source="pack://application:,,,/StyleResource/IconLibrary.xaml"/>
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>

    </UserControl.Resources>

    <Grid x:Name="PaymentParent">
        <Grid.ColumnDefinitions >
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="330"/>
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <!--<RowDefinition Height="55" />
            <RowDefinition Height="10" />-->
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <GroupBox x:Name="grpBoxStudent"  Grid.Row="1" Grid.Column="0"  >
            <GroupBox.Header>
                <Grid>
                    <Grid.ColumnDefinitions >
                        <ColumnDefinition Width="30" />
                        <ColumnDefinition Width="30" />
                        <ColumnDefinition Width="105" />
                        <ColumnDefinition Width="0" />
                        <ColumnDefinition Width="0" />
                        <ColumnDefinition Width="0" />
                        <ColumnDefinition Width="0" />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <mui:ModernButton x:Name="btnRefresh" Grid.Row="0" Grid.Column="0" IconData="{Binding Data, Source={StaticResource ImgRefresh}}"  EllipseDiameter="25" EllipseStrokeThickness="1" ToolTip="Refresh data" Click="btnRefresh_Click" />
                    <mui:ModernButton x:Name="btnAddStudent" Grid.Row="0" Grid.Column="1"  IconData="{Binding Data, Source={StaticResource ImgAddStudent}}"  EllipseDiameter="25" EllipseStrokeThickness="1" ToolTip="Mark Member Attendance" Click="btnAddStudent_Click"/>
                    <CheckBox Name="chkStopRefresh" Grid.Row="0" Grid.Column="2" Content="Stop Refresh" Margin="5,0,0,0" Checked="chkStopRefresh_Checked" Unchecked="chkStopRefresh_Unchecked"   />
                    <!--<mui:ModernButton x:Name="btnAddTute" Grid.Row="0" Grid.Column="1" IconData="{Binding Data, Source={StaticResource ImgAddTute}}"  EllipseDiameter="25" EllipseStrokeThickness="1" ToolTip="Distribute Documents" Click="btnAddTute_Click"/>
                    <mui:ModernButton x:Name="btnAddHistory" Grid.Row="0" Grid.Column="2" IconData="{Binding Data, Source={StaticResource ImgHistory}}"  EllipseDiameter="25" EllipseStrokeThickness="1" ToolTip="Class History" Click="btnAddHistory_Click" />
                    <mui:ModernButton x:Name="btnSendSMS" Grid.Row="0" Grid.Column="3" IconData="{Binding Data, Source={StaticResource ImgSMS}}"  EllipseDiameter="25" EllipseStrokeThickness="1" ToolTip="Send SMS" Click="btnSendSMS_Click" />
                    <mui:ModernButton x:Name="btnPrintrid" Grid.Row="0" Grid.Column="4" IconData="{Binding Data, Source={StaticResource ImgPrint}}"  EllipseDiameter="25" EllipseStrokeThickness="1" ToolTip="Print Attendance" Click="btnPrintrid_Click" />-->
                    <!--<mui:ModernButton x:Name="btnDelete" Grid.Row="0" Grid.Column="6" IconData="{Binding Data, Source={StaticResource ImgDelete}}"  EllipseDiameter="25" EllipseStrokeThickness="1" ToolTip="Delete all Attendance" Click="btnDelete_Click"  />-->
                </Grid>
            </GroupBox.Header>
            <Grid  >
                <!--<ScrollViewer Background="Transparent" VerticalScrollBarVisibility="Auto" Height="{Binding Path=ActualHeight,RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=UIElement}}"  >-->
                <ScrollViewer x:Name="TS" Grid.Row="1" VerticalAlignment="Stretch" VerticalScrollBarVisibility="Auto" CanContentScroll="True" PanningMode="VerticalOnly" SnapsToDevicePixels="True" Background="Transparent" 
                              PreviewMouseWheel="TS_PreviewMouseWheel" Height="{Binding Path=ActualHeight,RelativeSource={RelativeSource Mode=FindAncestor, AncestorType=UIElement}}">
                    <DataGrid Name="grdStudentAttendance" AutoGenerateColumns="False"  CanUserAddRows="False" RowHeaderWidth="30" LoadingRow="DataGrid_LoadingRow" 
                         CanUserDeleteRows="False" EnableRowVirtualization = "True" ScrollViewer.CanContentScroll="False" ScrollViewer.HorizontalScrollBarVisibility="Disabled" ScrollViewer.VerticalScrollBarVisibility="Disabled"  >
                        <DataGrid.Resources>
                            <mycls:DoubleToVisaulConverter x:Key="DoubleToVis" />
                            <mycls:TelephoneNumberConvetor x:Key="TelephoneNumberConvetor" />
                        </DataGrid.Resources>
                        <DataGrid.Columns>    
                            <DataGridTextColumn Header="CLS_ID" Binding="{Binding Path=CLS_ID}" IsReadOnly="True" Visibility="Hidden" />
                            <DataGridTextColumn Header="STD_GENDER" Binding="{Binding Path=STD_GENDER}" IsReadOnly="True" Visibility="Hidden" />
                            <DataGridTextColumn Header="STD_DATEOFBIRTH" Binding="{Binding Path=STD_DATEOFBIRTH}" IsReadOnly="True" Visibility="Hidden" />
                            <DataGridTextColumn Header="STD_EMAIL" Binding="{Binding Path=STD_EMAIL}" IsReadOnly="True" Visibility="Hidden" />
                            <DataGridTextColumn Header="STD_ADDRESS" Binding="{Binding Path=STD_ADDRESS}" IsReadOnly="True" Visibility="Hidden" />
                            <DataGridTextColumn Header="STD_COMMENT" Binding="{Binding Path=STD_COMMENT}" IsReadOnly="True" Visibility="Hidden" />
                            <DataGridTextColumn Header="STD_TEMP_NOTE" Binding="{Binding Path=STD_TEMP_NOTE}" IsReadOnly="True" Visibility="Hidden" />
                            <DataGridTextColumn Header="ID" Binding="{Binding Path=STD_ID}" IsReadOnly="True" Width="50" Visibility="Hidden"/>
                            <DataGridTextColumn Header="Initials" Binding="{Binding Path=STD_INITIALS}" IsReadOnly="True" Width="60" Visibility="Hidden" />
                            <DataGridTextColumn Header="Surname" Binding="{Binding Path=STD_SURNAME}" IsReadOnly="True" Width="100" Visibility="Hidden"/>
                            <DataGridTextColumn Header="Full Name" Binding="{Binding Path=STD_FULL_NAME}" IsReadOnly="True" Width="250" Visibility="Hidden"/>
                            <DataGridTextColumn Header="Join Date" Binding="{Binding Path=STD_JOIN_DATE , StringFormat={}{0:dd/MM/yyyy}}" IsReadOnly="True" Width="80"  Visibility="Hidden" />
                            <DataGridTextColumn Header="NIC" Binding="{Binding Path= STD_NIC}" IsReadOnly="True" Width="100" Visibility="Hidden"/>
                            <DataGridTextColumn Header="Class fee" Binding="{Binding Path=STD_CLASS_FEE}" IsReadOnly="True" Width="70" Visibility="Hidden" />
                            <DataGridCheckBoxColumn Header="Active" Binding="{Binding Path=STD_ACTIVE_FLG}" IsReadOnly="True" Width="50" Visibility="Hidden"/>

                            <DataGridTextColumn Header="Class Date" Binding="{Binding Path=CLS_REC_DATE}" IsReadOnly="True" Visibility="Hidden" />
                            <DataGridTextColumn Header="ID" Binding="{Binding Path=STD_ID}" IsReadOnly="True"  Width="45" Visibility="Hidden" />
                            <DataGridTextColumn Header="ID" Binding="{Binding Path=ATT_ID}" IsReadOnly="True"  Width="80" />
                            <DataGridTextColumn Header="Name" IsReadOnly="True" Width="130" SortMemberPath="STD_INITIALS"  >
                                <DataGridTextColumn.Binding>
                                    <MultiBinding StringFormat="{}{0},{1}">
                                        <Binding Path="STD_INITIALS" />
                                        <Binding Path="STD_SURNAME" />
                                    </MultiBinding>
                                </DataGridTextColumn.Binding>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Telephone" Binding="{Binding Path=STD_TELEPHONE,Converter={StaticResource TelephoneNumberConvetor}}" IsReadOnly="True"  Width="110">
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Last Check In" Binding="{Binding Path=CHECKTIME, StringFormat={}{0:dd/MM/yyyy hh:mm tt}}" IsReadOnly="True"  Width="150" />
                            <DataGridTextColumn Header="Last Paid" Binding="{Binding Path=LASTPAIDDAATE, StringFormat={}{0:dd/MM/yyyy}}"  IsReadOnly="True"  Width="80" />
                            <DataGridTextColumn Header="Payment Due" Binding="{Binding Path=VALID_DUE_DATE, StringFormat={}{0:dd/MM/yyyy}}"  IsReadOnly="True"  Width="90" />
                            <DataGridTextColumn Header="Arr" Binding="{Binding Path=PENDING_COUNT}" IsReadOnly="True"  Width="35" />                            
                            <DataGridTextColumn Header="Fee" Binding="{Binding CLASS_FEE}" IsReadOnly="True" Width="45" Visibility="Hidden" />
                            <DataGridCheckBoxColumn Header="Card" Binding="{Binding Path=CARD_ISSUED_FLG}" IsReadOnly="True" Width="40" Visibility="Hidden"/>
                            <DataGridTemplateColumn  Width="30" >
                                <DataGridTemplateColumn.CellTemplate >
                                    <DataTemplate >
                                        <mui:ModernButton x:Name="btnPayment" Click="btnPayment_Click" IconData="{Binding Data, Source={StaticResource ImgEdit}}"  EllipseDiameter="25" EllipseStrokeThickness="1" ToolTip="Payment"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellStyle >
                                    <Style TargetType="DataGridCell">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding STD_PAID_STATUS}" Value="0">
                                                <Setter Property="Background" Value="White" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding STD_PAID_STATUS}" Value="1">
                                                <Setter Property="Background" Value="Red" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTemplateColumn.CellStyle>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn  Width="40" Visibility="Hidden" >
                                <DataGridTemplateColumn.CellTemplate >
                                    <DataTemplate >
                                        <mui:ModernButton x:Name="btnEdit" IconData="{Binding Data, Source={StaticResource ImgEdit}}"  EllipseDiameter="25" EllipseStrokeThickness="1" ToolTip="Change Student Record" Click="btnEdit_Click"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>                           
                            <DataGridTemplateColumn  Width="30" >
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <mui:ModernButton x:Name="btnComments" IconData="{Binding Data, Source={StaticResource ImgAlert}}"  EllipseDiameter="25" EllipseStrokeThickness="0" ToolTip="{Binding Path= STD_TEMP_NOTE }"  
                                                                       Visibility="{Binding Path=STD_COMMENT_FLG,Converter={StaticResource DoubleToVis}}" Click="btnComments_Click"  />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                                <DataGridTemplateColumn.CellStyle >
                                    <Style TargetType="DataGridCell">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding STD_COMMENT_FLG}" Value="0">
                                                <Setter Property="Background" Value="White" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding STD_COMMENT_FLG}" Value="1">
                                                <Setter Property="Background" Value="#FFFFF300" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTemplateColumn.CellStyle>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn  Width="40" >
                                <DataGridTemplateColumn.CellTemplate >
                                    <DataTemplate >
                                        <mui:ModernButton x:Name="btnSendSMS" IconData="{Binding Data, Source={StaticResource ImgSMS}}"  EllipseDiameter="25" EllipseStrokeThickness="1" ToolTip="Send SMS" Click="btnSendSMS_Click_1"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn Header="RSN_ID" Binding="{Binding Path=RSN_ID}" IsReadOnly="True" Visibility="Hidden" />
                        </DataGrid.Columns>
                    </DataGrid>

                </ScrollViewer>
            </Grid>
        </GroupBox>
        <Grid Grid.Row="0" Grid.Column="1"  Margin="0,20,0,0" >
            <Grid.ColumnDefinitions >
                <ColumnDefinition Width="40" />
                <ColumnDefinition Width="200" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>
            <Grid.RowDefinitions>
                <RowDefinition Height="25" />
                <RowDefinition Height="1" />
                <RowDefinition Height="30" />
                <RowDefinition Height="30" />
                <RowDefinition Height="30" />
                <RowDefinition Height="30" />
                <RowDefinition Height="30" />
                <RowDefinition Height="30" />
                <RowDefinition Height="30" />
                <RowDefinition Height="30" />
                <RowDefinition Height="200" />
            </Grid.RowDefinitions>

            <DatePicker  x:Name="dtpHoldDate" Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" Margin="10,0,0,0"  SelectedDate="{x:Static sys:DateTime.Now}" HorizontalAlignment="Left" Width="103" SelectedDateChanged="dtpHoldDate_SelectedDateChanged"  >
                <DatePicker.Resources>
                    <Style TargetType="DatePickerTextBox">
                        <Setter Property="IsReadOnly" Value="True"/>
                    </Style>
                </DatePicker.Resources>
            </DatePicker>

            <ComboBox x:Name="cmbClsGroup" Grid.Row="0" Grid.Column="1" Margin="4,0,0,25" Style="{DynamicResource ComboBoxFlatStyle}" SelectionChanged="cmbClsGroup_SelectionChanged" Visibility="Hidden"/>
            <TextBox Name="txtWeekNumber" Grid.Column="2" Margin="0,0,43,25" IsEnabled="False" MaxLines="1" MaxLength="3" HorizontalAlignment="Right" Width="47" Visibility="Hidden"/>
            <Label Grid.Row="0" Grid.Column="2" Content="Week" Margin="62,5,0,25" FontWeight="Bold" Foreground="#FF005A99" MouseDoubleClick="Label_MouseDoubleClick" Visibility="Hidden"/>
            <ComboBox x:Name="cmbPart" Grid.Row="0" Grid.Column="3" Style="{DynamicResource ComboBoxFlatStyle}"  Margin="0,0,0,25"  IsEnabled="False" Visibility="Hidden">
            </ComboBox>
            <CheckBox Grid.Row="0" Grid.Column="4"  x:Name="chkClassHoldFlg" Content="Held" Margin="10,0,0,25" Checked="chkClassHoldFlg_Checked" PreviewTextInput="NumberValidationTextBox" Visibility="Hidden"/>
            <mui:ModernButton x:Name="btnSaveClass" Grid.Row="0" Grid.Column="5"  Click="btnSaveClass_Click" IconData="{Binding Data, Source={StaticResource ImgAttendance}}" EllipseDiameter="26" Margin="10,0,0,21" 
                RenderTransformOrigin="0.464,0.069" Height="29" VerticalAlignment="Bottom" Visibility="Hidden" >
            </mui:ModernButton>
            <CheckBox Name="chkShowInactive" Grid.Row="2" Grid.Column="0" Content="Show all inactive calsses" Checked="chkShowInactive_Checked" Unchecked="chkShowInactive_Unchecked" Visibility="Hidden"  />
            <CheckBox Name="chkSelectedDay" Grid.Row="3" Grid.Column="0" Content="Remove day Filter" Checked="chkAelectedDay_Checked" Unchecked="chkAelectedDay_Unchecked" Visibility="Hidden"  />


            <Image x:Name="lblAttendanceImage" Grid.Row="3" Grid.Column="0" Source="/CMSXtream;component/Image/Attended.png"  />
            <Label x:Name="lblAttendanceCount" Grid.Row="3" Grid.Column="1" Margin="5,0,0,0" FontSize="14" FontWeight="Bold"  />

            <Image x:Name="lblCard" Grid.Row="4" Grid.Column="0" Source="/CMSXtream;component/Image/ClassCards.png" ToolTip="Not paid count" Margin="5,0,0,0" />
            <Label x:Name="lblCardCount" Grid.Row="4" Grid.Column="1" Margin="5,0,0,0" FontSize="14" FontWeight="Bold" ToolTip="Not paid count" Foreground="Red"  />

            <Image Name="imgTemp" Grid.Row="4" Grid.Column="0" Source ="pack://application:,,,/Image/ImgTemInactive.png" VerticalAlignment="Stretch" HorizontalAlignment="Stretch"  Visibility="Hidden" />
            <Button  Grid.Row="4" Grid.Column="3" Name="btnTempInactive" Margin="10,5,5,5"  Cursor="Hand" ToolTip="View temporarily inactive students" Click="btnTempInactive_Click"  Visibility="Hidden" >
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <TextBlock TextDecorations="Underline">
                <ContentPresenter />
                        </TextBlock>
                    </ControlTemplate>
                </Button.Template>
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Foreground" Value="#FFF57777" />
                        <Setter Property="FontSize" Value="14" />
                        <Setter Property="FontWeight" Value="Bold" />
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="Foreground" Value="Blue" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>

            <Image Name="imgPermnt" Grid.Row="5" Grid.Column="0" Source ="pack://application:,,,/Image/ImgActive.png" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Visibility="Hidden"  />
            <Button  Grid.Row="3" Grid.Column="1" Name="btnPermInactive" Margin="10,0,5,5"  Cursor="Hand"  ToolTip="Click to view active students" Click="btnPermInactive_Click" Height="20" VerticalAlignment="Bottom"  Visibility="Hidden" >
                <Button.Template>
                    <ControlTemplate TargetType="Button">
                        <TextBlock TextDecorations="Underline">
                <ContentPresenter />
                        </TextBlock>
                    </ControlTemplate>
                </Button.Template>
                <Button.Style>
                    <Style TargetType="Button">
                        <Setter Property="Foreground" Value="Red" />
                        <Setter Property="FontSize" Value="14" />
                        <Setter Property="FontWeight" Value="Bold" />
                        <Style.Triggers>
                            <Trigger Property="IsMouseOver" Value="true">
                                <Setter Property="Foreground" Value="Blue" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Button.Style>
            </Button>



            <Border Grid.Row="6" Grid.Column="0"  BorderThickness="1" CornerRadius="5,0,5,0" BorderBrush="Black" Width="20" Height="20" Background="#FF04B835" RenderTransformOrigin="0.4,-0.35" Margin="10,0,10,5"  Visibility="Hidden"  >
            </Border>
            <Label  Grid.Row="6" Grid.Column="1" Content="1Wk delayed "  Visibility="Hidden" />

            <Border Grid.Row="7" Grid.Column="0"  BorderThickness="1" CornerRadius="5,0,5,0" BorderBrush="Black" Width="20" Height="20" Background="#FFF19538" Margin="10,0,10,5"  Visibility="Hidden" >
            </Border>
            <Label  Grid.Row="7" Grid.Column="1" Content="2Wk delayed"  Visibility="Hidden" />

            <Border Grid.Row="8" Grid.Column="0"  BorderThickness="1" CornerRadius="5,0,5,0" BorderBrush="Black" Width="20" Height="20" Background="#FFFF1700" RenderTransformOrigin="0.5,-0.55" Margin="10,0,10,5"  Visibility="Hidden" >
            </Border>
            <Label  Grid.Row="8" Grid.Column="1" Content="3Wk delayed "  Visibility="Hidden" />
            <Border Grid.Row="9" Grid.Column="0"  BorderThickness="1" CornerRadius="5,0,5,0" BorderBrush="Black" Width="20" Height="20" Background="Black" RenderTransformOrigin="0.3,-0.55" Margin="10,0,10,5"  Visibility="Hidden"  >
            </Border>
            <Label  Grid.Row="9" Grid.Column="1" Content="More than 3Wk delayed "  Visibility="Hidden" />
            <TextBox  x:Name="txtComment"  Grid.Row="10" Grid.Column="0" Grid.ColumnSpan="2" Margin="11,0,0,4"  MaxLength="250" TextWrapping="Wrap" AcceptsReturn="True" MaxWidth="500" TabIndex="6" Background="#FFE7FCFF" Visibility="Hidden"   />

            <Label Name="lblError" Grid.Column="0" Grid.Row="6" Grid.ColumnSpan="2" FontSize="10" Margin="5,0.2,-0.4,0" Grid.RowSpan="3" />
            <ProgressBar Name="pbStatus" Minimum="0" Maximum="100" Grid.Column="0" Grid.Row="6" Grid.ColumnSpan="2" IsIndeterminate="True" ></ProgressBar>

            <Label Name="lblError2" Grid.Column="0" Grid.Row="8" Grid.ColumnSpan="3" FontSize="10" Margin="5,0.2,-0.4,0" Grid.RowSpan="3" />
            <ProgressBar Name="pbStatus2" Minimum="0" Maximum="100" Grid.Column="0" Grid.Row="8" Grid.ColumnSpan="2" IsIndeterminate="True" ></ProgressBar>


        </Grid>
    </Grid>
</UserControl>
